(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{167:function(e,t,a){e.exports=a(334)},172:function(e,t,a){},173:function(e,t,a){},175:function(e,t,a){},317:function(e,t,a){},318:function(e,t,a){},328:function(e,t,a){},332:function(e,t,a){},333:function(e,t,a){},334:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(9),l=a.n(o);a(172),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var s=a(26),c=a(150),i=a(151),u=a(163),m=a(152),p=a(164),d=a(39),h=(a(173),a(105)),b=a.n(h),f=a(153),v=a(42),E=a(154),g=(a(175),a(45)),w=a(19),k=function(e){var t=Object.keys(e.pollQuestions).map(function(t){var a=e.pollQuestions;if(0!==a[t].length)return Object(E.a)({},t,a[t])}).filter(function(e){return e}).reduce(function(e,t){var a=Object.keys(t),n=Object.values(t);return e[a[0]]={pollOption:n[0]},e},{});return{question:e.question,pollQuestions:t}},O=w.object().shape({question:w.string().required("Poll must have a question").max(78),pollQuestions:w.object().shape({poll1:w.string().required("Required field").max(48,"Must be shorter than 48 characters"),poll2:w.string().required("Required field").max(48,"Must be shorter than 48 characters"),poll3:w.string().max(48,"Must be shorter than 48 characters"),poll4:w.string().max(48,"Must be shorter than 48 characters"),poll5:w.string().max(48,"Must be shorter than 48 characters"),poll6:w.string().max(48,"Must be shorter than 48 characters"),poll7:w.string().max(48,"Must be shorter than 48 characters"),poll8:w.string().max(48,"Must be shorter than 48 characters")})}),y=function(e){var t=Object(n.useState)(!1),a=Object(v.a)(t,2),o=a[0],l=a[1],s=Object(n.useState)(null),c=Object(v.a)(s,2),i=c[0],u=c[1],m=Object(n.useRef)(2);return Object(n.useEffect)(function(){var e;return o?e=setTimeout(function(){l(!1)},3500):clearTimeout(e),clearTimeout(e)},[o]),r.a.createElement("div",{className:"create-poll"},i&&r.a.createElement("h2",{className:"error"},i),r.a.createElement(g.d,{initialValues:{question:"",pollQuestions:{poll1:"",poll2:"",poll3:"",poll4:"",poll5:"",poll6:"",poll7:"",poll8:""}},validationSchema:O,onSubmit:function(){var t=Object(f.a)(b.a.mark(function t(a){var n,r,o;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return l(!0),n=k(a),t.prev=2,t.next=5,fetch("/createpoll",{method:"POST",body:JSON.stringify(n)});case 5:return r=t.sent,t.next=8,r.json();case 8:if(o=t.sent,console.log(o),o){t.next=12;break}return t.abrupt("return");case 12:l(!1),e.history.push("/vote/".concat(o)),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(2),console.log(t.t0),u("Sever error... try again");case 20:case"end":return t.stop()}},t,null,[[2,16]])}));return function(e){return t.apply(this,arguments)}}()},function(e){var t=e.values;return r.a.createElement(g.c,null,r.a.createElement("div",{className:"poll-content"},r.a.createElement(g.b,{name:"question",className:"question input-design",placeholder:"Enter your question here",autoComplete:"off"}),r.a.createElement(g.a,{name:"question",component:"span"}),Object.keys(t.pollQuestions).map(function(e,a){if(!(a>=m.current)){var n=t.pollQuestions["poll".concat(m.current)];return n&&n.length>1&&(m.current+=1),r.a.createElement("div",{className:"master-div",key:e},r.a.createElement("div",{className:"subdiv"},r.a.createElement("div",{className:"circle"}),r.a.createElement(g.b,{key:e,placeholder:"Enter poll option",name:"pollQuestions.".concat(e),className:"input-design",autoComplete:"off",type:"text"})),r.a.createElement(g.a,{name:"pollQuestions.".concat(e),component:"span",className:"custom-error"}))}}),r.a.createElement("div",{className:"button"},r.a.createElement("button",{type:"submit",disabled:o,className:"submit-button ".concat(o?"off-button":"")},o?"Waiting...":"Submit"))))}))},j=a(157),N=(a(317),function(e){var t={},a={};if(e.poll){var n=Object.values(e.poll.pollQuestions);t={labels:n.map(function(e){return"".concat(e.pollOption," ").concat(e.count," votes")}),datasets:[{label:e.poll.question,data:n.map(function(e){return e.count}),backgroundColor:"rgba(178,53,53,.75)",hoverBackgroundColor:"rgba(178,53,53,.85)"}]},a={legend:{labels:{fontColor:"black"}},scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMin:0,suggestedMax:n.reduce(function(e,t){return e+t.count},0),fontColor:"black",stepSize:1}}],xAxes:[{ticks:{fontColor:"black"}}]}}}return r.a.createElement("div",{className:"create-poll results"},e.poll&&r.a.createElement(j.a,{data:t,options:a}))}),S=a(366),x=(a(318),function(e){var t=e.error,a=e.poll,o=Object(n.useState)(""),l=Object(v.a)(o,2),c=l[0],i=l[1];return r.a.createElement("div",{className:"create-poll vote-poll"},!a&&r.a.createElement("h2",{style:{margin:"auto"},className:"poll-question"},"Fetching Poll..."),t&&r.a.createElement("div",{className:"vote-error"},r.a.createElement("span",null,t.message),r.a.createElement(s.b,{className:"error-button",to:"/"},"Create new poll")),a&&r.a.createElement("div",{className:"vote-success"},r.a.createElement("span",{className:"poll-question"},a.question),r.a.createElement("div",{className:"poll-questions"},Object.keys(a.pollQuestions).map(function(e){var t=a.pollQuestions;return r.a.createElement("div",{className:"quest",key:e},r.a.createElement(S.a,{className:"radio-button",name:e,checked:c===e,onChange:function(e){return i(e.target.name)}}),r.a.createElement("label",null,t[e].pollOption))})),c.length>0&&r.a.createElement("button",{className:"submit-button",onClick:function(){var t=e.ws,a={id:e.match.params.id,upvote:c,type:"upvote"};t.send(JSON.stringify(a)),e.history.push("/view/".concat(e.match.params.id))}},"Submit")))}),q=(a(328),function(){return r.a.createElement("nav",null,r.a.createElement(s.b,{to:"/",className:"brand-logo"},r.a.createElement("h4",null,"Go Poll")))}),C=a(365),M=a(364),Q=a(161),W=(a(332),a(363)),I=Object(W.a)(function(e){return{button:{margin:e.spacing(1)},input:{display:"none"}}}),T=r.a.memo(function(e){var t=e.id?"".concat(document.location.host,"/vote/").concat([e.id]):"poo",a=I(),o=Object(n.useState)(!1),l=Object(v.a)(o,2),s=l[0],c=l[1];return r.a.createElement("div",{className:"master-share ".concat(e.id?"":"hide")},r.a.createElement("div",{className:"inner-share"},r.a.createElement(C.a,{label:"Share your poll!",value:t}),r.a.createElement(Q.CopyToClipboard,{text:t,onCopy:function(){return c(!0)}},r.a.createElement(M.a,{variant:"outlined",color:"secondary",className:a.button},s?"Copied!":"Share"))))}),J=(a(333),function(e){return Object(n.useEffect)(function(){e.error||e.history.push("/")},[]),r.a.createElement("div",{className:"create-poll vote-error err"},e.error&&r.a.createElement("div",null,r.a.createElement("span",null,e.error.message),r.a.createElement(s.b,{onClick:function(){return e.clearError()},className:"error-button",to:"/"},"Create new poll")))}),P=function(e){var t=Object(d.e)(e,{path:"/:param/:id",exact:!0,strict:!1});return t&&t.params.id.length>0?t.params:null},_=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).webSocket=void 0,a.state={ws:null,poll:null,creator:!1,pollId:P(a.props.location.pathname),error:null},a.setMessage=function(){a.state.ws.addEventListener("message",a.readWs)},a.readWs=function(e){if(e.data){var t=JSON.parse(e.data);if(t.error)a.handleError(t);else if(a.state.error)a.setState({error:null,poll:t});else switch(t.type){case"upvote":var n=a.state.poll;n.pollQuestions[t.upvote].count+=1,a.setState({poll:n});break;default:a.setState({poll:t})}}},a.handleError=function(e){switch(e.type){case"invalid_id":e.message="The ID entered seems to be invalid";case"not_found":e.message="Poll could not be found";case"duplicate_ip":a.setState({error:e});break;default:a.setState({error:e,poll:null,ws:null},function(){a.state.ws.close()})}},a.clearError=function(){a.setState({error:null})},a.webSocket="wss://".concat(document.location.hostname,"/socket/"),a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillUnmount",value:function(){this.state.ws&&this.state.ws.removeEventListener("message",this.readWs)}},{key:"componentDidMount",value:function(){var e=this,t=this.state,a=t.pollId;if(!t.ws&&a&&a.id.length>0){var n=this.webSocket+a;this.setState({ws:new WebSocket(n)},function(){return e.setMessage()})}}},{key:"componentDidUpdate",value:function(){var e=this,t=this.state,a=t.pollId,n=t.ws,r=t.error,o=P(this.props.location.pathname);if(o)if(!a||a&&a.id!==o.id){n&&n.close();var l=this.webSocket+o.id;this.setState({pollId:o,ws:new WebSocket(l)},function(){return e.setMessage()})}else r&&this.props.history.push("/error");else a&&(n.close(),n.removeEventListener("message",this.setMessage),this.setState({pollId:null,ws:null,poll:null}))}},{key:"render",value:function(){var e=this;return console.log(this.state),r.a.createElement("div",{className:"main"},r.a.createElement(q,null),r.a.createElement(T,{id:this.state.poll?this.state.poll._id:null}),r.a.createElement(d.c,null,r.a.createElement(d.a,{path:"/view/:id",render:function(t){return r.a.createElement(N,Object.assign({},t,{poll:e.state.poll}))}}),r.a.createElement(d.a,{path:"/vote/:id",render:function(t){return r.a.createElement(x,Object.assign({},t,{ws:e.state.ws,poll:e.state.poll,error:e.state.error}))}}),r.a.createElement(d.a,{path:"/error",render:function(t){return r.a.createElement(J,Object.assign({},t,{error:e.state.error,clearError:e.clearError}))}}),r.a.createElement(d.a,{path:"/",render:function(e){return r.a.createElement(y,e)}})))}}]),t}(n.Component),A=Object(d.f)(_);l.a.render(r.a.createElement(s.a,null,r.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[167,1,2]]]);
//# sourceMappingURL=main.b8b35cad.chunk.js.map